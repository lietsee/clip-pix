# Pinterest スタイルグリッド改修計画

最終更新: 2025-10-20

## 目的
- 高さが異なるカードを隙間なく配置する Pinterest 風グリッドを実現し、カード数増加時でも滑らかに動作するようにする。
- 列数・背景色などの表示設定をユーザーが制御できるようにし、グリッド全体の UX を刷新する。

## フェーズ構成

### フェーズ1: 基盤整備
- カスタム `Sliver` を実装し、列数・ギャップを考慮した Pinterest 風レイアウトを提供。
- `GridViewModule` を新レイアウトに差し替え、既存の全件ビルド問題を解消。
- 列数/背景色/カード幅設定などの新設定項目を Hive に保存。
- 設定メニューを新設し、上記項目とカード一括サイズ調整操作（即時適用 + Undo/Redo スタックの土台）を提供。
- 影響ドキュメントの更新。

### フェーズ2: カードインタラクション拡張
- カード幅リサイズを列単位に制限し、高さはユーザー補正値で制御可能に変更。
- `ImageCard` 上にスワップハンドルを追加し、ドラッグ&ドロップで並び替え可能にする。並び順は Hive に永続化。
- リサイズ/スワップ/コピー UI のホバー時フェード演出を実装。
- 右クリック＋ホイールのズームをカーソル位置中心に変更し、`Shift + ドラッグ` でパンできるようにする。

### フェーズ3: 仕上げと最適化
- Undo/Redo（3 履歴）の実装を完成させ、アプリ終了時に履歴を破棄。
- 画像ロード時の `gaplessPlayback` 等を調整し点滅を抑制。
- パフォーマンス計測と負荷テストの実施。
- マニュアル/テストケースの追記。

## 主要タスク一覧
- [ ] Pinterest スタイル `Sliver` 実装（列数/ギャップ計算、遅延構築対応）。
- [ ] `GridViewModule` を新 `Sliver` + 設定駆動の列数に対応させる。
- [ ] 設定モデル/Hive アダプタを拡張し、列数・最大列数・背景色・カード一括幅を保持。
- [ ] 設定メニュー UI 作成、Undo/Redo スタックのスケルトン実装。
- [ ] `ImageCard` 改修（列単位リサイズ、ホバー UI、ズーム/パン刷新、スワップハンドル追加）。
- [ ] 並び替えのドラッグ&ドロップと永続化。
- [ ] 自動・手動による一括サイズ調整ロジックの実装。
- [ ] 単体テスト/ウィジェットテスト追加。
- [ ] ドキュメント更新（`docs/ui/grid_view.md` 他）。

## リスク / 注意点
- 新 `Sliver` のレイアウトアルゴリズムは複雑なため、回帰テストとスクロールパフォーマンス検証を重点的に行う。
- 設定項目増加に伴い Hive のバージョン管理と移行処理が必要。
- Undo/Redo はサイズ変更に限定し、他の操作と干渉しないようスコープを明確にする。

## 次アクション（2025-10-20 時点）
1. `PinterestSliverGrid`（仮称）のプロトタイプを追加し、`GridViewModule` へ統合する。
2. 列数・背景色設定用のモデル/Hive 永続化コードを追加する。
3. 設定パネル UI の骨子を作成し、列数/背景色変更がリアルタイムに反映されるところまで実装。

